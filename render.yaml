## Render Blueprint — Dice Reward
##
## Deploy:  https://dashboard.render.com/select-repo  → "Existing Blueprint"
##
## Two options to store data (pick ONE):
##
##  A) Persistent Disk  — auto-configured below (Render Starter plan, $7/mo for backend)
##     DB_PATH=/data/data.db  ← set automatically
##
##  B) Turso cloud DB   — free tier, survives redeploys on any plan
##     1. Sign up at https://turso.tech/, create a DB
##     2. Copy Database URL + Auth Token
##     3. Set TURSO_DATABASE_URL and TURSO_AUTH_TOKEN in the backend service's env vars
##        (override / remove DB_PATH)
##

services:
  # ─── Backend ─────────────────────────────────────────────────────────────
  - type: web
    name: dice-backend
    runtime: node
    rootDir: apps/backend
    region: singapore
    plan: starter             # Starter plan required for Persistent Disk
    buildCommand: npm install && npm run build
    startCommand: npm run start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: DB_PATH
        value: /data/data.db   # Persistent Disk mount path
      - key: FRONTEND_ORIGIN
        sync: false            # Set this to your frontend URL after first deploy
                               # e.g. https://dice-frontend.onrender.com
    disk:
      name: dice-data
      mountPath: /data
      sizeGB: 1

  # ─── Frontend (Static Site) ───────────────────────────────────────────────
  - type: static
    name: dice-frontend
    rootDir: apps/frontend
    region: singapore
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    envVars:
      - key: VITE_API_BASE_URL
        sync: false           # Set this to backend URL after backend is deployed
                              # e.g. https://dice-backend.onrender.com
    headers:
      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
      - path: /*
        name: Cache-Control
        value: no-cache
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
