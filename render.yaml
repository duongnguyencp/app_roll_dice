## Render Blueprint — Dice Reward (Turso edition)
##
## Deploy:
##   1. Tạo DB trên Turso: https://turso.tech  (free tier)
##        turso db create dice-reward
##        turso db show dice-reward  → copy URL
##        turso db tokens create dice-reward  → copy token
##   2. https://dashboard.render.com/select-repo → chọn repo → "Use Blueprint"
##   3. Điền TURSO_DATABASE_URL và TURSO_AUTH_TOKEN khi Render hỏi (sync: false)
##   4. Sau khi backend deploy xong → copy URL → điền vào VITE_API_BASE_URL + FRONTEND_ORIGIN
##

services:
  # ─── Backend ─────────────────────────────────────────────────────────────
  - type: web
    name: dice-backend
    runtime: node
    rootDir: apps/backend
    region: singapore
    plan: free                # Turso free tier → không cần Persistent Disk
    buildCommand: npm install && npm run build
    startCommand: npm run start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: TURSO_DATABASE_URL
        sync: false           # libsql://your-db-name.turso.io
      - key: TURSO_AUTH_TOKEN
        sync: false           # token từ: turso db tokens create <db-name>
      - key: FRONTEND_ORIGIN
        sync: false           # https://dice-frontend.onrender.com (sau khi frontend deploy)

  # ─── Frontend (Static Site) ───────────────────────────────────────────────
  - type: static
    name: dice-frontend
    rootDir: apps/frontend
    region: singapore
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    envVars:
      - key: VITE_API_BASE_URL
        sync: false           # Set this to backend URL after backend is deployed
                              # e.g. https://dice-backend.onrender.com
    headers:
      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
      - path: /*
        name: Cache-Control
        value: no-cache
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
